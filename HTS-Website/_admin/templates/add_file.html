{% extends "admin_sidebar.html" %}
{% block body %}


    <script> 
        function printDiv() { 
            var divContents = document.getElementById("barcode").innerHTML; 
            var a = window.open('', '', 'height=500, width=500'); 
            a.document.write('<html>'); 
            a.document.write('<body > <h3>File Barcode:</h3> <br>'); 
            a.document.write(divContents); 
            a.document.write('</body></html>'); 
            a.document.close(); 
            a.print(); 
            window.location.reload();
        } 
        

    </script> 


    <script>
        
        $('#file_picker').change(function(){    
            //on change event  
            formdata = new FormData();
            if($(this).prop('files').length > 0)
        {
            file =$(this).prop('files')[0];
            formdata.append("file", file);
            var value = $("#appid").val();
            formdata.append("q", value);
        }
        });
        
    </script>    




  	<div class="container register-form">
            <div class="form">
                <div class="note">
                    <p id="add_file">ADD FILE</p>
                </div>
                <form action="" method="post">
                <div class="form-content">
                    
                    <div class="row">
                        <div class="col-md-3 align-self-center"></div>                       
                        <div class="col-md-6 align-self-center">
                            <div class="form-group">
                                
                                <select type="text" class="form-control" placeholder="Application ID" id="appid" value="" required style="height: 48px;" >
                                <option>Choose Application ID</option>
                                </select>
                                
                            </div>
                        </div>      
                        <div class="col-md-3 align-self-center"></div>
                    </div>
                    
                    <div class="row" style=" padding-top: 50px;">
                        <div class="col-md-5 align-self-center" style="text-align: center">
                            
                            <button type="button"class="btn btn-primary" id="gen_code" onclick="get_barcode();">Generate Barcode &  Save</button>
                        
                        </div>
                        <div class="col-md-2 align-self-center" style="vertical-align: middle; text-align: center"> OR </div>
                        <div class="col-md-5 align-self-center">
                        
                            <input type="file"class="form-control-file" id="file_picker" >
                            
                        </div>
                            
                    </div>
                    
                    <div class="row" style=" padding-top: 50px;">
                        <div class="col-md-5 align-self-center" style="text-align: center">                           
                             <div id = "barcode"></div>
                        </div>
                        
                        <div class="col-md-2 align-self-center"> </div>
                        
                        <div class="col-md-5 align-self-center" style="text-align: center">
                        
                        <button type="button"class="btn btn-primary" id="fileuploadbtn" onclick="">Upload File</button>
                            
                        </div>
                            
                    </div>
                    
                    <div class="row" style=" padding-top: 30px;">
                        <div class="col-md-5 align-self-center" style="text-align: center">                           
                             <button type="button"class="btn btn-primary" onclick="printDiv()" style="display: none"><i class="fas fa-print" id="prit" > Print</i></button>
                        </div>
                        
                        <div class="col-md-2 align-self-center"> </div>
                        
                        <div class="col-md-5 align-self-center" style="text-align: center">
                        
                            <div id ="loader">Uploading File...</div>
                            
                        </div>
                            
                    </div>
                    
                    <div class="row" style=" padding-top: 20px;">
                        
                        <div class="col-md-12 align-self-center" style="">                           
                             <div id ="Success"></div>
                        </div>
                            
                    </div>
                    
                    </div>
                </form>
        </div>
           
        </div>

  		
<script type="text/javascript">
    function get_barcode() {
            var xmlhttp = new XMLHttpRequest();
            var application = document.getElementById('appid');
            var val = document.getElementById("barcode");
            var label = document.getElementById("Success");
            label.innerHTML="";
            val.innerHTML="";
        
            value = $("#appid").val();
            console.log("File Type " + value)
        
           /* var x = localStorage.getItem("url");*/
        
            if(value == "Choose Application ID"){
                console.log("No value")
                 document.getElementById("Success").innerHTML = '<p type="text" id="Success" style="color: red; padding: 35px 70px;" >Please Select Application ID</p> ';
            }
               
            var dataString = 'q=' +value;
              $.ajax({
                type: "GET",
                url: "{{url_for('backendapp.generate_barcode')}}",
                data: dataString,
                cache: false,
                success: function(response){
                  //check if what response is   
                    console.log(response);
                    if(response["status"]==="1"){
                        
                        realData = response["image"];
                        val.innerHTML="<img src='data:image/png;base64,"+realData+"'/>";

                    }
                    
                    //alert(response);
                } 
              });
            
                
            }
        
</script>

<!-- -------------------Script for Digital File--------------------------------------->

<script>
    
var fileselected = 
    
    
    
function upload_file(){
    
    var application = document.getElementById('appid');
    var label = document.getElementById("Success");
    label.innerHTML="";
    
    if(value == "Choose Application ID"){
                console.log("No value")
                 document.getElementById("Success").innerHTML = '<p type="text" id="Success" style="color: red; padding: 35px 70px;" >Please Select Application ID</p> ';
            }
    
              $.ajax({
                type: "Post",
                url: "{{url_for('backendapp.generate_digital_file')}}",
                data: formdata,
                processData: false,
                contentType: false,
                success: function(response){
                  //check if what response is   
                    console.log(response);
                    if(response["status"]==="1"){
                        
                        label.innerHTML="File Uploaded Successfully!";

                    }
                    
                    //alert(response);
                } 
              });
    
}    
    
    
</script>


<!-- -------------------Script for Digital File--------------------------------------->

<script>

function loaddepts(){
               
    var select =  document.getElementById("appid");  
      
      console.log("calllled");
       $.post("{{url_for('backendapp.get_app_types')}}",
                
                function(response){
                  //check if what response is 
           
                    
                var details = response["appids"];
                
                    console.log(details);
                
           
                     for(var i = 0;i < details.length;i++)
                     {
                         var opt = details[i]['appname']+' ('+details[i]['appid']+')';
                         
                         var el = document.createElement("option");
                         el.textContent = opt;
                       //  el.value = opt;
                         el.value = details[i]['appid'];
                    
                         select.appendChild(el);
                     }

                    
                    //alert(response);
                
              },"json");
  
}
    
    loaddepts();

</script>

<script src="{{ url_for('adminapp.static',filename='js/change_language.js')}}"></script>
 <script type="text/javascript">
      var lang = sessionStorage.getItem("lang");
      if(lang === "nepali"){
                change_lang();
                }
      function change_lang(){
          add_file.innerHTML = language.nep.add_file;
          gen_code.innerHTML = language.nep.generate_bcode_save;
          prit.innerHTML = language.nep.print;
    
      }
 </script>

{% endblock %}